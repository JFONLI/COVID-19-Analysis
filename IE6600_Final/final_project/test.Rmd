---
title: "Untitled"
author: "Yen-Fong Li"
date: "2022-12-05"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r cars}
library(maps)
library(mapproj)
library(shiny)
library(dplyr)
library(tidyverse)
library(ggplot2)
```

#Dataset 1

## Import Data
```{r}
count_death_cleaned_model <- readRDS("www/data/count_death_cleaned_model.RDS")
count_death_cleaned_visual_1 <- readRDS("www/data/count_death_cleaned_visual_1.RDS")
count_death_cleaned_visual_2 <- readRDS("www/data/count_death_cleaned_visual_2.RDS")

count_death_cleaned_model
count_death_cleaned_visual_1
count_death_cleaned_visual_2
```

## Correlation Map
```{r}
diseases <- colnames(count_death_cleaned_model)[c(8,9,12:23)]
diseases
rename_diseases <- c("All Causes", "Natural Causes", "Septicemia", "Maligant neoplasms", "Diabetes mellitus", "Alzheimer disease",
  "Influenza and pneumonia", "Chronic lower respiratory", "Respiratory system", "Nephritis", "Symtoms signs", "Diseases of heart",
  "Cerebrovascular", "COVID-19")

cor_count_death <- count_death_cleaned_model[,diseases]
cor_count_death
colnames(cor_count_death) <- rename_diseases
cor_count_death

# install.packages("corrplot")
library(corrplot)

correlation <- cor(cor_count_death)
corrplot(correlation)
# corrplot(correlation, method="circle", type='upper', tl.cex=0.7, tl.col = 'black')
```


## Bar Chart
```{r}

```


# Dataset 2 
## Import Dataset
```{r}
condition_covi_cleaned <- readRDS("www/data/condition_covi_cleaned.RDS")
condition_covi_cleaned
```


```{r}
remove_state <- c("United States", "Alaska", "American Samoa", "Hawaii", "New York City", "Puerto Rico")
temp <- condition_covi_cleaned %>% filter(group == "By Total" & !state %in% remove_state)
temp <- temp %>% filter(condition_group == "Respiratory diseases" & age_group == "All Ages")
temp
temp <- temp %>% group_by(state) %>% summarise(deathes = sum(covi_death)) 

# District of Columbia, 
temp
temp$deathes
temp$rank <- rank(-temp$deathes, ties.method = c("first"))
temp$state

shades <- colorRampPalette(c("darkgreen", "white"))(53)
shades
fills <- shades[temp$rank]
fills
#  [1] "alabama"              "arizona"              "arkansas"             "california"           "colorado"            
#  [6] "connecticut"          "delaware"             "district of columbia" "florida"              "georgia"             
# [11] "idaho"                "illinois"             "indiana"              "iowa"                 "kansas"              
# [16] "kentucky"             "louisiana"            "maine"                "maryland"             "massachusetts"       
# [21] "michigan"             "minnesota"            "mississippi"          "missouri"             "montana"             
# [26] "nebraska"             "nevada"               "new hampshire"        "new jersey"           "new mexico"          
# [31] "new york"             "north carolina"       "north dakota"         "ohio"                 "oklahoma"            
# [36] "oregon"               "pennsylvania"         "rhode island"         "south carolina"       "south dakota"        
# [41] "tennessee"            "texas"                "utah"                 "vermont"              "virginia"            
# [46] "washington"           "west virginia"        "wisconsin"            "wyoming"           
# fills[4] = "black"

maps::map("state", fill = TRUE, col = fills)
```

## Bar Chart
```{r}

```

## Time Series
```{r}

```

# Dataset 3
## Import Dataset
```{r}
covi_data_cleaned_model <- readRDS("www/data/covi_data_cleaned_model.RDS")
covi_data_cleaned_visual <- readRDS("www/data/covi_data_cleaned_visual.RDS")
covi_data_cleaned_model
covi_data_cleaned_visual
```
## Clear Data
clean unused states
```{r}
states <- c("alabama", "arizona", "arkansas", "california", "colorado", "connecticut", "delaware", "district of columbia", 
            "florida", "georgia", "idaho", "illinois", "indiana", "iowa", "kansas", "kentucky", "louisiana", "maine",
            "maryland", "massachusetts", "michigan", "minnesota", "mississippi", "missouri", "montana", "nebraska",
            "nevada", "new hampshire", "new jersey", "new mexico", "new york", "north carolina", "north dakota", "ohio",
            "oklahoma", "oregon", "pennsylvania", "rhode island", "south carolina", "south dakota", "washington",
            "west virginia", "wisconsin", "wyoming")
temp <- covi_data_cleaned_model %>% filter(tolower(covi_data_cleaned_model$state) %in% states)
temp$state %>% unique()
temp <- temp %>% group_by(date, state) %>% summarise(total_cases <- sum(tot_cases),
                                      new_case <- sum(new_case))
colnames(temp) <- c("state", "date", "total_cases", "new_cases")
temp
```



## Map
```{r}
temp
```

## Time Series
```{r}
states <- c("alabama", "arizona", "arkansas", "california", "colorado", "connecticut", "delaware", "district of columbia", 
            "florida", "georgia", "idaho", "illinois", "indiana", "iowa", "kansas", "kentucky", "louisiana", "maine",
            "maryland", "massachusetts", "michigan", "minnesota", "mississippi", "missouri", "montana", "nebraska",
            "nevada", "new hampshire", "new jersey", "new mexico", "new york", "north carolina", "north dakota", "ohio",
            "oklahoma", "oregon", "pennsylvania", "rhode island", "south carolina", "south dakota", "washington",
            "west virginia", "wisconsin", "wyoming")
states %>% length()
#  [1] "alabama"              "arizona"              "arkansas"             "california"           "colorado"            
#  [6] "connecticut"          "delaware"             "district of columbia" "florida"              "georgia"             
# [11] "idaho"                "illinois"             "indiana"              "iowa"                 "kansas"              
# [16] "kentucky"             "louisiana"            "maine"                "maryland"             "massachusetts"       
# [21] "michigan"             "minnesota"            "mississippi"          "missouri"             "montana"             
# [26] "nebraska"             "nevada"               "new hampshire"        "new jersey"           "new mexico"          
# [31] "new york"             "north carolina"       "north dakota"         "ohio"                 "oklahoma"            
# [36] "oregon"               "pennsylvania"         "rhode island"         "south carolina"       "south dakota"        
# [41] "tennessee"            "texas"                "utah"                 "vermont"              "virginia"            
# [46] "washington"           "west virginia"        "wisconsin"            "wyoming"     
unique(covi_data_cleaned_model$state)
covi_data_cleaned_model$state %>% unique()
remove_state <- c("United States", "Alaska", "American Samoa", "Hawaii", "New York City", "Puerto Rico")
tolower(covi_data_cleaned_model$state) %in% states
temp <- covi_data_cleaned_model %>% filter(tolower(covi_data_cleaned_model$state) %in% states)
temp$state %>% unique()
temp

ggplot(temp %>% filter(state == "Arizona"), aes(x = date)) +
  geom_area(aes(y = tot_cases), color="blue", fill= "blue", size=1) +
  geom_area(aes(y = new_case), color = "red", fill = "red", size = 1)
temp

temp <- temp %>% group_by(date) %>% summarise(total_cases <- sum(tot_cases),
                                      new_case <- sum(new_case))
colnames(temp) <- c("date", "total_cases", "new_cases")

ggplot(temp, aes(x = date)) +
  geom_area(aes(y = total_cases), color = "blue", fill = "blue", size = 1) +
  geom_area(aes(y = new_cases), color = "red", fill = "red", size = 1)

```



