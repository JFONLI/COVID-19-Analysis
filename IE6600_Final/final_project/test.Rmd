---
title: "Untitled"
author: "Yen-Fong Li"
date: "2022-12-05"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
install.packages("multiInput")
```


```{r cars}
library(maps)
library(mapproj)
library(shiny)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(usmap)
library(plotly)
```

#Dataset 1

## Import Data
```{r}
count_death_cleaned_model <- readRDS("www/data/count_death_cleaned_model.RDS")
count_death_cleaned_visual_1 <- readRDS("www/data/count_death_cleaned_visual_1.RDS")
count_death_cleaned_visual_2 <- readRDS("www/data/count_death_cleaned_visual_2.RDS")

count_death_cleaned_model
count_death_cleaned_visual_1
count_death_cleaned_visual_2

count_death_cleaned_visual_2$disease_type %>% unique()
```

## Correlation Map
```{r}
diseases <- colnames(count_death_cleaned_model)[c(8,9,12:23)]
diseases
rename_diseases <- c("All Causes", "Natural Causes", "Septicemia", "Maligant neoplasms", "Diabetes mellitus", "Alzheimer disease",
  "Influenza and pneumonia", "Chronic lower respiratory", "Respiratory system", "Nephritis", "Symtoms signs", "Diseases of heart",
  "Cerebrovascular", "COVID-19")
count_death_cleaned_model
temp <- count_death_cleaned_model
temp$race %>% unique()
temp <- temp %>% filter(sex == "male")
temp
cor_count_death <- temp[,diseases]
cor_count_death
colnames(cor_count_death) <- rename_diseases
cor_count_death

# install.packages("corrplot")
library(corrplot)

correlation <- cor(cor_count_death)
corrplot(correlation)
# corrplot(correlation, method="circle", type='upper', tl.cex=0.7, tl.col = 'black')
```


## Bar Chart
```{r}

# Plot 2
count_death_cleaned_visual_2
count_death_bar <- count_death_cleaned_visual_2
sexes <- c("female")
count_death_bar <- filter(count_death_bar, sex %in% sexes)

count_death_bar

ggplot() +
  geom_col(data = count_death_bar, aes(y = disease_type,x = death_by_disease, fill = age_group), position = "fill")


# Plot 1
# count_death_bar_1 <- count_death_bar
# count_death_bar$percents <- count_death_bar$death_by_disease / count_death_bar$cause_all

count_death_bar <- count_death_bar %>% group_by(disease_type) %>% summarise(
  total_counts = sum(death_by_disease), all_causes = cause_all)
# count_death_bar$all_causes <- sum(count_death_bar$all_causes)
# count_death_bar <- count_death_bar %>% unique()
# count_death_bar$percents <- count_death_bar$total_counts / count_death_bar$all_causes * 100
count_death_bar$sum_of_diseases <- sum(count_death_bar$total_counts)
count_death_bar$percents_100 <- count_death_bar$total_counts / count_death_bar$sum_of_diseases

ggplot(count_death_bar) +
  geom_col(aes(y = disease_type, x = percents_100)) +
  scale_x_reverse() +
  scale_y_discrete(position = "right")

# -----------------------------------
p1 <- ggplot() +
  geom_col(data = count_death_bar_1, aes(y = disease_type, death_by_disease, 
                                         x = death_by_disease, 
                                         fill = age_group), position = "fill") +
  theme(plot.background = element_blank())
  
p2 <- ggplot(count_death_bar) +
  geom_col(aes(x = disease_type, y = percents_100)) +
  
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        plot.background = element_blank()) +
  scale_x_reverse()
  
count_death_bar %>% arrange(desc(date_start))
count_death_bar_1%>% arrange(desc(date_start))

ggplot(count_death_bar) +
  #geom_col(aes(x = disease_type, y = percents)) +
  geom_point(aes(x = disease_type, y = percents_100)) +
  geom_line(aes(x = disease_type, y = percents_100))


```


# Dataset 2 
## Import Dataset
```{r}
condition_covi_cleaned <- readRDS("www/data/condition_covi_cleaned.RDS")
condition_covi_cleaned$state %>% unique()
```

# Map 
```{r}
remove_state <- c("United States", "Alaska", "American Samoa", "Hawaii", "New York City", "Puerto Rico")
temp <- condition_covi_cleaned %>% filter(group == "By Total" & !state %in% remove_state)
temp <- temp %>% filter(condition_group == "Respiratory diseases" & age_group == "All Ages")
temp
temp <- temp %>% group_by(state) %>% summarise(deathes = sum(covi_death)) 

# District of Columbia, 
temp
temp$deathes
temp$rank <- rank(-temp$deathes, ties.method = c("first"))
temp$state

shades <- colorRampPalette(c("darkgreen", "white"))(53)
shades
fills <- shades[temp$rank]
fills

maps::map("state", fill = TRUE, col = fills)
```
# Map 2
```{r}
map_2 <- condition_covi_cleaned
map_2
map_2 <- map_2 %>% filter(group == "By Month")
map_2 <- map_2 %>% mutate("date" = make_date(year = year, month = month))
map_2$covi_death[is.na(map_2$covi_death)] <- 0
map_2 <- map_2 %>% group_by(state) %>% summarise(deaths = sum(covi_death))
map_2

plot_usmap(data = map_2, values = "deaths", color = "red")

covi_data_cleaned_visual
map <- covi_data_cleaned_visual
map
# map <- map %>% filter(tolower(state) %in% states)
map <- map %>% filter(number_type == "tot_cases")
# map %>% filter(date > as.Date("2020-01-22"), date < as.Date("2020-01-27"))

map <- map %>% group_by(state) %>% summarise(total_cases = sum(number_value))
map


?scale_fill_continuous
plot_usmap(data = map, values = "total_cases", color = "red")

```



## Bar Chart
```{r}

## Plot 1
bar_chart_2 <- condition_covi_cleaned
bar_chart_2 <- bar_chart_2 %>% filter(age_group == "All Ages" & group == "By Total" & state != "United States")
bar_chart_2 <- bar_chart_2 %>% filter(state == "Alabama")
bar_chart_2$covi_death[is.na(bar_chart_2$covi_death)] <- 0
bar_chart_2$total_deaths <- sum(bar_chart_2$covi_death)
bar_chart_2 <- bar_chart_2 %>% group_by(condition_group, total_deaths) %>% summarise(deaths = sum(covi_death))
bar_chart_2$percents_100 <- bar_chart_2$deaths / bar_chart_2$total_deaths * 100


ggplot(bar_chart_2) +
  geom_col(aes(x = percents_100, y = condition_group)) +
  scale_y_discrete(position = "right") +
  scale_x_reverse

## Plot 2
condition_covi_cleaned
bar_chart <- condition_covi_cleaned

bar_chart <- bar_chart %>% filter(state == "Alabama" & group == "By Total" & !age_group %in% c("Not stated", "All Ages"))

bar_chart$covi_death[is.na(bar_chart$covi_death)] <- 0
bar_chart


ggplot(bar_chart) +
  geom_col(aes(x = covi_death, y = condition_group, fill = age_group), position = "fill")
```

## Time Series
```{r}
condition_covi_cleaned
time_series <- condition_covi_cleaned
time_series <- time_series[,-11] %>% filter(group == "By Month")
# time_series <- time_series[,-11]
# time_series <- time_series %>% filter(group == "By Month")
time_series <- time_series %>% mutate("date" = make_date(year = year, month = month))
time_series <- time_series %>% filter(state == "Alabama" & age_group == "35-44")
time_series

# time_series$covi_death[is.na(time_series$covi_death)] <- 0
time_series <- time_series %>% drop_na()
# time_series %>% group_by(date, condition) %>% mutate(deaths = sum(covi_death))
time_series <- time_series %>% group_by(date, condition_group) %>% summarise(deaths = sum(covi_death))

time_series



p <- ggplot(time_series) +
  geom_line(aes(x = date, y = deaths, color = condition_group), size = 2)

ggplotly(p)

```

# Dataset 3
## Import Dataset
```{r}
covi_data_cleaned_model <- readRDS("www/data/covi_data_cleaned_model.RDS")
covi_data_cleaned_visual <- readRDS("www/data/covi_data_cleaned_visual.RDS")
covi_data_cleaned_model
covi_data_cleaned_visual
```
## Clear Data
clean unused states
```{r}
states <- c("alabama", "arizona", "arkansas", "california", "colorado", "connecticut", "delaware", "district of columbia", 
            "florida", "georgia", "idaho", "illinois", "indiana", "iowa", "kansas", "kentucky", "louisiana", "maine",
            "maryland", "massachusetts", "michigan", "minnesota", "mississippi", "missouri", "montana", "nebraska",
            "nevada", "new hampshire", "new jersey", "new mexico", "new york", "north carolina", "north dakota", "ohio",
            "oklahoma", "oregon", "pennsylvania", "rhode island", "south carolina", "south dakota", "washington",
            "west virginia", "wisconsin", "wyoming")
temp <- covi_data_cleaned_model %>% filter(tolower(covi_data_cleaned_model$state) %in% states)
temp$state %>% unique()
temp <- temp %>% group_by(date, state) %>% summarise(total_cases <- sum(tot_cases),
                                      new_case <- sum(new_case))
colnames(temp) <- c("date", "state", "total_cases", "new_cases")
temp
```



## Map
```{r}
covi_data_cleaned_visual
map <- covi_data_cleaned_visual
map
# map <- map %>% filter(tolower(state) %in% states)
map <- map %>% filter(number_type == "tot_cases")
# map %>% filter(date > as.Date("2020-01-22"), date < as.Date("2020-01-27"))

map <- map %>% group_by(state) %>% summarise(total_cases = sum(number_value))
map

library(usmap)

plot_usmap(data = map, values = "total_cases", color = "red")

```

## Time Series
```{r}

temp <- covi_data_cleaned_model
temp <- temp %>% filter(!state %in% c("United States", "New York City", "Puerto Rico"))
temp <- temp %>% filter(state == "California")
temp

ggplot(temp, aes(x = date)) +
  geom_area(aes(y = tot_cases), color = "blue", fill = "blue", size = 1) +
  geom_area(aes(y = new_case), color = "red", fill = "red", size = 1) 

```



